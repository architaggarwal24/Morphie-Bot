<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Morphie Bot</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gradient-to-br from-[#1e1e2f] to-[#0f0f1a] h-screen flex items-center justify-center">

<div class="w-[420px] h-[680px] bg-white/10 backdrop-blur-2xl rounded-2xl shadow-2xl flex flex-col">

  <!-- HEADER -->
  <div class="px-4 py-3 border-b border-white/10">
    <div class="text-center text-white font-semibold">MORPHIE âœ¨</div>

    <div class="flex justify-center gap-2 mt-3">
      <button id="chatBtn" onclick="switchMode('chat')"
        class="mode-btn active">ðŸ’¬ Chat</button>
      <button id="designBtn" onclick="switchMode('design')"
        class="mode-btn">ðŸŽ¨ Design</button>
    </div>
  </div>

  <!-- CHAT -->
  <div id="chat" class="flex-1 overflow-y-auto px-4 py-3 space-y-3"></div>

  <!-- INPUT -->
  <div class="p-4 border-t border-white/10">
    <div class="flex gap-2">
      <textarea id="input" rows="1"
        placeholder="Type here..."
        class="flex-1 resize-none px-4 py-2 rounded-xl bg-white/20 text-white placeholder-white/60 focus:outline-none"></textarea>
      <button onclick="sendMessage()"
        class="px-4 py-2 rounded-xl bg-indigo-600 hover:bg-indigo-700 active:scale-95 transition text-white font-semibold">
        Send
      </button>
    </div>
  </div>
</div>

<script>
let currentMode = "chat";
let chatMemory = { chat: [], design: [] };

const chat = document.getElementById("chat");
const input = document.getElementById("input");

function renderMessages() {
  chat.innerHTML = "";
  chatMemory[currentMode].forEach(m => {
    const div = document.createElement("div");
    div.className = `max-w-[75%] px-4 py-2 rounded-xl text-white ${
      m.sender === "user" ? "ml-auto bg-indigo-600" : "bg-white/20"
    }`;
    div.innerHTML = m.content;
    chat.appendChild(div);
  });
  chat.scrollTop = chat.scrollHeight;
}

function addMessage(content, sender = "bot") {
  chatMemory[currentMode].push({ content, sender });
  renderMessages();
}

function switchMode(mode) {
  if (mode === currentMode) return;
  currentMode = mode;

  document.getElementById("chatBtn").classList.toggle("active", mode === "chat");
  document.getElementById("designBtn").classList.toggle("active", mode === "design");

  fetch("/chat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ message: mode + " mode" })
  });

  renderMessages();
}

async function sendMessage() {
  const text = input.value.trim();
  if (!text) return;

  addMessage(text, "user");
  input.value = "";

  const res = await fetch("/chat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ message: text })
  });

  const data = await res.json();

  if (data.type === "theme") {
    renderTheme(data.data);
  } else {
    addMessage(data.content);
  }
}

function renderTheme(data) {
  let html = `<div class="font-semibold mb-2">ðŸŽ¨ Colors</div>`;

  data.colors.forEach(c => {
    html += `
      <div class="space-y-2 mb-4">

        <div class="flex items-center gap-2">
          <span class="w-4 h-4 rounded border" style="background:${c.primary_color}"></span>
          <span class="px-2 py-0.5 text-xs rounded bg-white/10">Primary</span>
          <code class="text-sm">${c.primary_color}</code>
        </div>

        <div class="flex items-center gap-2">
          <span class="w-4 h-4 rounded border" style="background:${c.secondary_color}"></span>
          <span class="px-2 py-0.5 text-xs rounded bg-white/10">Secondary</span>
          <code class="text-sm">${c.secondary_color}</code>
        </div>

        <div class="flex items-center gap-2">
          <span class="w-4 h-4 rounded border" style="background:${c.accent_color}"></span>
          <span class="px-2 py-0.5 text-xs rounded bg-white/10">Accent</span>
          <code class="text-sm">${c.accent_color}</code>
        </div>

      </div>
    `;
  });

  html += `<div class="font-semibold mt-2">ðŸ§© Layouts</div>
           <ul class="list-disc list-inside text-sm">
             ${data.layouts.map(l => `<li>${l}</li>`).join("")}
           </ul>`;

  addMessage(html);
}

input.addEventListener("keydown", e => {
  if (e.key === "Enter" && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
});
</script>

<style>
.mode-btn {
  padding: 6px 12px;
  font-size: 12px;
  border-radius: 999px;
  background: rgba(255,255,255,0.15);
  color: white;
  cursor: pointer;
  transition: all 0.2s ease;
}
.mode-btn:hover {
  background: rgba(255,255,255,0.25);
}
.mode-btn.active {
  background: #4f46e5;
}
</style>

</body>
</html>
